{# homepagestyle.njk #}

{% macro menuItemOpenAll(name, item, step) %}
  <div style="margin-left: {{ step * 1.5 }}rem; margin-bottom: 0.3rem;">
    {% if item.isFolder %}
      <div><strong>{{ name }}</strong></div>
      {% for childName, child in item %}
        {# Skip metadata keys #}
        {% if childName not in ["isNote", "isFolder", "hide", "permalink", "name", "noteIcon", "pinned"] %}
          {{ menuItemOpenAll(childName, child, step + 1) }}
        {% endif %}
      {% endfor %}
    {% elif item.isNote %}
      <div>
        <a href="{{ item.permalink }}">{{ item.name }}</a>
      </div>
    {% else %}
      {# In case there are unexpected structures, just show the name #}
      <div>{{ name }}</div>
    {% endif %}
  </div>
{% endmacro %}

<style>
  .front-index {
    display: flex;
    flex-wrap: wrap;
    gap: 2rem;
  }
  .front-index > nav {
    flex: 1 1 45%;
    max-width: 48%;
    min-width: 300px;
    overflow-wrap: anywhere;
  }
  .foldername-wrapper {
    display: flex;
    align-items: center;
  }
  .foldername-wrapper span:first-child {
    font-size: 0.75rem;
    user-select: none;
  }
  .notelink a:hover {
    text-decoration: underline;
    color: #0366d6;
  }
</style>

<h2>File Tree Index</h2>

<div class="front-index" x-data>
  {% if filetree and filetree.Orneu %}
    {% set keys = filetree.Orneu | dictsort %}
    {% set half = (keys | length / 2) | round(0, 'ceil') %}
    <nav>
      {% for key, node in keys[0:half] %}
        {{ menuItem(key, node, 0, key) }}
      {% endfor %}
    </nav>
    <nav>
      {% for key, node in keys[half:] %}
        {{ menuItem(key, node, 0, key) }}
      {% endfor %}
    </nav>
  {% else %}
    <p>No filetree data found.</p>
  {% endif %}
</div>
